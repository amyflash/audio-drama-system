# 极简广播剧管理与在线收听系统
# 产品需求规格说明书 (PRD)

**项目名称：** 极简广播剧管理与在线收听系统
**版本号：** V1.0.0
**文档编写日期：** 2026-02-28
**文档状态：** 正式发布

---

## 1. 项目概述

### 1.1 项目背景

广播剧作为一种深受大众喜爱的音频娱乐形式，其版权保护与受控分发至关重要。当前市场上的音频管理平台大多功能复杂、部署成本高，不适合小规模的广播剧工作室或个人创作者使用。

本项目旨在构建一个轻量级、易部署的 Web 系统，实现广播剧专辑资源的统一管理及受控分发，同时通过严格的在线人数控制和防下载机制保护版权。

### 1.2 项目目标

- **统一管理**：管理员可以便捷地上传、分类、管理音频资源
- **受控分发**：授权用户可在线收听，严禁下载
- **成本控制**：通过在线人数（10人）上限控制带宽成本
- **版权保护**：防盗链、防下载机制确保音频安全

### 1.3 适用场景

- 小型广播剧工作室
- 个人音频创作者
- 私有音频资源分享
- 内部培训音频管理

---

## 2. 用户角色定义

| 角色 | 描述 | 权限范围 | 使用场景 |
| :--- | :--- | :--- | :--- |
| **Admin (管理员)** | 系统所有者，工作室运营人员 | - 专辑/音频的增删改查<br>- 批量上传音频<br>- 查看系统状态和在线人数<br>- 管理用户账号 | 上传新专辑、维护音频库、查看系统运行状况 |
| **User (普通用户)** | 授权听众，审核通过的会员 | - 登录系统<br>- 浏览专辑列表<br>- 在线播放音频<br>- 收藏专辑（V1.1） | 在线收听广播剧，享受高质量音频内容 |
| **Visitor (访客)** | 未登录用户 | - 仅可访问登录页 | 首次访问，需注册/登录后使用 |

---

## 3. 核心功能需求

### 3.1 鉴权与并发控制系统

#### 3.1.1 登录功能

**需求描述：**
用户通过用户名/密码进行登录，系统需校验并发限制。

**功能详情：**

| 项 | 说明 |
| :--- | :--- |
| **输入字段** | 用户名（必填）、密码（必填） |
| **并发校验** | 登录时检查当前在线会话数 |
| **登录成功** | 创建安全会话，Session 有效期 30 分钟 |
| **登录失败** | 若在线数 >= 10，提示"系统在线人数已达上限（10/10），请稍后重试" |
| **自动下线** | 用户若 30 分钟无操作，自动下线释放名额 |
| **心跳保活** | 前端每 15 分钟请求一次 `/api/heartbeat` 刷新会话 |

**错误码：**
- `200 OK`: 登录成功
- `401 Unauthorized`: 用户名或密码错误
- `403 Forbidden`: 在线人数已达上限
- `423 Locked`: 账号被锁定（V1.2）

#### 3.1.2 权限守卫

**需求描述：**
所有业务接口必须验证用户身份和权限。

**拦截规则：**
- 未登录用户访问受控接口 → 返回 401，跳转登录页
- 访客访问内容页面 → 返回 401，跳转登录页
- 普通用户访问管理接口 → 返回 403，权限不足

### 3.2 后台管理系统 (Admin Only)

#### 3.2.1 专辑管理

**需求描述：**
管理员可以创建、查看、编辑、删除专辑。

**专辑信息字段：**

| 字段 | 类型 | 必填 | 说明 |
| :--- | :--- | :--- | :--- |
| title | String | 是 | 专辑名称 |
| cover_image | Image | 是 | 封面图（支持 JPG/PNG，最大 2MB） |
| description | Text | 否 | 专辑简介 |
| sort_order | Int | 否 | 展示排序，默认 0 |
| created_at | DateTime | 自动 | 创建时间 |

**功能清单：**
- ✅ 新建专辑：输入专辑信息，上传封面
- ✅ 专辑列表：分页展示，支持搜索和筛选
- ✅ 编辑专辑：修改专辑信息、替换封面
- ✅ 删除专辑：删除专辑及其下所有音频文件

#### 3.2.2 音频管理

**需求描述：**
管理员可以批量上传音频，管理剧集信息。

**音频信息字段：**

| 字段 | 类型 | 必填 | 说明 |
| :--- | :--- | :--- | :--- |
| album_id | Int | 是 | 所属专辑 ID |
| title | String | 是 | 标题（如："第一话"） |
| file_path | String | 自动 | 服务器存储路径 |
| duration | Int | 自动 | 时长（秒），上传后自动解析 |
| sort_order | Int | 否 | 集数顺序，默认 0 |
| created_at | DateTime | 自动 | 上传时间 |

**功能清单：**
- ✅ 批量上传：支持选择多个 MP3/M4A 文件，自动关联到指定专辑
- ✅ 剧集列表：查看专辑下的剧集，支持排序
- ✅ 编辑剧集：修改标题、排序
- ✅ 删除剧集：删除单集文件和数据库记录
- ⏳ 集合并移动（V1.1）：将剧集移动到其他专辑

**上传限制：**
- 单文件最大：100MB
- 支持格式：MP3、M4A、FLAC
- 批量数量：单次最多 20 个文件

#### 3.2.3 系统监控（V1.2）

**需求描述：**
管理员可查看系统运行状态。

**监控指标：**
- 当前在线人数
- 今日访问量
- 存储空间使用情况
- 系统日志查询

### 3.3 用户收听前台

#### 3.3.1 专辑展示

**需求描述：**
普通用户可以浏览所有已发布的专辑。

**展示内容：**
- 专辑封面
- 专辑标题
- 专辑简介
- 剧集数量
- 创建时间

**交互功能：**
- 点击专辑查看详情
- 搜索专辑（V1.1）
- 筛选最新/热门（V1.1）

#### 3.3.2 在线播放器

**需求描述：**
用户可在页面内播放音频，无下载权限。

**播放器功能：**

| 功能 | 描述 |
| :--- | :--- |
| 播放/暂停 | 控制音频播放 |
| 快进/快退 | 支持 10s、30s 快捷跳转 |
| 上一集/下一集 | 切换剧集 |
| 播放进度条 | 可拖动进度条调整播放位置 |
| 音量控制 | 调节音量，支持静音 |
| 倍速播放 | 0.5x、1x、1.25x、1.5x、2x（V1.1） |
| 播放列表 | 显示当前专辑的剧集列表 |

**防下载机制：**
- ❌ 禁用右键菜单
- ❌ 禁用 F12 开发者工具
- ❌ 禁止 Ctrl+S、Ctrl+C 复制
- 🔒 音频通过动态 API 流式传输，不暴露静态文件 URL
- 🔒 音频 URL 带有临时 Token，过期自动失效

**防盗链措施：**
- Nginx 配置 Referer 检查，只允许本域名请求
- 音频流 Token 有效期与 Session 同步（30 分钟）

#### 3.3.3 用户体验优化

**需求描述：**
提升用户使用体验。

**优化点：**
- ✅ 自动播放：播放完上一集自动播放下一集
- ✅ 记忆播放：记录当前播放位置，下次继续（V1.1）
- ✅ 暗黑模式：支持切换主题（V1.2）
- ✅ 响应式设计：支持手机/平板访问

---

## 4. 非功能需求

### 4.1 性能需求

| 指标 | 要求 |
| :--- | :--- |
| **并发性能** | 支持 10 人同时在线，播放不卡顿 |
| **响应时间** | 页面加载 < 2s，API 响应 < 500ms |
| **文件上传** | 单文件上传（100MB）耗时 < 30s |
| **音频流** | 首次缓冲 < 3s |

### 4.2 安全需求

| 需求 | 技术方案 |
| :--- | :--- |
| *密码安全* | 使用 bcrypt 加密存储 |
| *防盗链* | Nginx Referer 检查 + Token 验证 |
| *防下载* | 动态流 API + Token 过期 + 禁用浏览器功能 |
| *会话管理* | Redis Session + TTL 自动过期 |
| *XSS 防护* | 输入过滤 + CSP 策略 |
| *CSRF 防护* | Token 验证（V1.2） |

### 4.3 可用性需求

| 需求 | 说明 |
| :--- | :--- |
| **系统可用性** | 99.9%（允许每月停机 43 分钟） |
| **数据备份** | 每日凌晨 3 点自动备份数据库 |
| **日志记录** | 记录操作日志，保留 30 天 |
| **错误处理** | 友好的错误提示，不暴露系统信息 |

### 4.4 可维护性需求

| 需求 | 说明 |
| :--- | :--- |
| **代码规范** | 遵循 PEP8（Python）和 ESLint（Vue）规范 |
| **文档完整** | API 文档、部署文档、故障排查文档 |
| **模块化** | 前后端分离，松耦合设计 |
| **容器化** | Docker Compose 一键部署 |

---

## 5. 系统约束

### 5.1 技术约束

- 部署环境：单台云服务器（2 核 4GB 起步）
- 数据库：SQLite（轻量级，满足需求）
- 缓存：Redis（Session 管理）
- 容器化：Docker + Docker Compose

### 5.2 业务约束

- 在线人数上限：10 人
- 音频格式：MP3、M4A、FLAC
- 单文件大小：100MB
- 音频总容量：建议不超过 100GB 可根据 VPS 容量调整）

### 5.3 法律合规

- **版权声明**：上传播播剧需确保拥有授权
- **用户协议**：用户需确认不下载、不传播
- **数据保护**：不收集用户隐私数据

---

## 6. 功能优先级

| 优先级 | 功能模块 | 计划版本 |
| :--- | :--- | :--- |
| **P0 (必须)** | 用户登录、并发控制、专辑管理、音频上传、在线播放 | V1.0 |
| **P1 (重要)** | 剧集排序、系统监控、播放列表 | V1.1 |
| **P2 (一般)** | 用户收藏、评论系统、暗黑模式 | V1.2 |

---

## 7. 项目风险与应对

| 风险 | 可能性 | 影响 | 应对措施 |
| :--- | :--- | :--- | :--- |
| 音频下载技术绕过 | 中 | 高 | 定期评估防下载方案，采用多层防护 |
| 并发控制失效 | 低 | 高 | 使用 Redis 强一致性，测试边界场景 |
| 性能瓶颈 | 中 | 中 | 缓存音频元数据，CDN 加速（V1.2） |
| 存储空间不足 | 低 | 中 | 监控存储使用，告警机制 |

---

## 8. 成功验收标准

### 8.1 功能验收

- [ ] 管理员可成功上传音频
- [ ] 10 人可同时在线播放不卡顿
- [ ] 第 11 人登录时被正确拒绝
- [ ] 普通用户无法下载音频
- [ ] 30 分钟无操作自动下线

### 8.2 性能验收

- [ ] 页面加载时间 < 2s
- [ ] API 响应时间 < 500ms
- [ ] 音频缓冲时间 < 3s

### 8.3 安全验收

- [ ] 无法通过浏览器直接下载音频
- [ ] 无法绕过登录访问受控接口
- [ ] 密码加密存储

---

## 9. 变更记录

| 版本 | 日期 | 变更内容 | 作者 |
| :--- | :--- | :--- | :--- |
| V1.0.0 | 2026-02-28 | 初始版本 | AI |
